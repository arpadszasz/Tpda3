#+TITLE:       Tpda3 - Configuration reference
#+DESCRIPTION: the page description, e.g.,
#+KEYWORDS:    the page keywords, e.g.,
#+AUTHOR:      Stefan Suciu
#+EMAIL:       stefan 'at' s2i2 . ro
#+LANGUAGE:    en
#+STYLE:       <link rel="stylesheet" type="text/css" href="css/org.css" />
#+OPTIONS:     ^:{}
#+STARTUP:     showall
#+STARTUP:     hidestars

The purpose of this document is to describe the configuration system
of Tpda3 with emphasis on the development of the applications.

?Distinguish? between the Tpda3 run time and Tpda3 applications.

* Configuration files

The configuration files are in YAML (YAML::Tiny) and Apache format
(Config::General). When the Tpda3 distribution is installed, a copy of
the default configuration tree, from the distributions share
directory, is installed in the Perl dirstribution tree.

When the tpda3 script is invoked for the first time, the Tpda3 default
configuration files are copied to the user's data directory. Next when
a specific Tpda3 application is executed, the application
configuration files are installed under the Tpda3 main configuration
path.

* Framework configurations
** The main configuration file

The main configuration file is, of course, main.yml and contains
generic configurations used by all the Tpda3 applications.

*** Sections
**** geometry

The default geometry of the main window of the application.

#+begin_src conf
  main: 520x80+20+20
#+end_src

**** interface

Relative paths for the configuration files of various GUI interface elements.

#+begin_src conf
  localize: etc/localisation/english.conf
  toolbar: etc/interfaces/toolbar.yml
  menubar: etc/interfaces/menubar.yml
#+end_src

**** runtime

Only one attribute, for now, the output path where the LaTeX files are
generated - from the Tpda3::Generator.pm module.

#+begin_src conf
  docspath: /tmp
#+end_src

**** resource

The icons path.

#+begin_src conf
  icons: etc/interfaces/icons
#+end_src

**** externalapps

Absolute paths to the executable utilities of the Report Manager and
LaTeX systems.

#+begin_src conf
  repman:
    exe_path: ~/bin/repman/printrep.bin
  pdflatex:
    exe_path: /usr/share/texmf/bin/pdflatex
    options: -halt-on-error                     # to be removed
#+end_src

* Application configurations
** Screen configuration

Every screen module has a coresponding configuration file in Apache
format as defined by the Config::General module.

A screen configuration file name is lower case of the screen module
name, but with a .conf extension.

*** Sections

**** screen

   |-------------+-----------+-----+-----------------------------------------------------|
   | Name        | Value     | R/O | Description                                         |
   |-------------+-----------+-----+-----------------------------------------------------|
   | version     | 4         | req | Config version for Tpda3 (v0.59)                    |
   | name        | <string>  | req | Same as the config file without the extension       |
   | description | <string>  | req | The descriptive name of the screen                  |
   | style       | default   | req | A normal screen with various widgets                |
   |             | report    | req | A screen with a THSHR widget                        |
   | geometry    | <WxH+x+y> | req | The default geometry of the screen                  |
   | details     | record    | opt | Defines screen modules designed for the details tab |
   |-------------+-----------+-----+-----------------------------------------------------|

#+begin_src conf
<details>
   match          = <field_name>
   filter         = <field_name>
   <detail>
      value       = <string>
      name        = <string>
   </detail>
   <detail>
      value       = <string>
      name        = <string>
   </detail>
</details>
#+end_src

**** defaultreport

Report Manager report file name bound to the print toolbar button.

#+begin_src conf
<defaultreport>
    name    = The report description
    file    = file-name.rep
</defaultreport>
#+end_src

**** defaultdocument

Document template file name bound to the edit toolbar button.

#+begin_src conf
<defaultdocument>
    name    = The report description
    file    = file-name.rep
</defaultdocument>
#+end_src

**** lists_ds

Data source for list widgets - Combobox (Tk::JComboBox).

**** list_header

Column names in the 'List' tab table, chosen from the field names from
the main table view. The order is preserved.

#+begin_src conf -n -r
<list_header>
    lookup    = [ id_pers ]   (ref:lookup)
    column    = nume          (ref:column)
    column    = prenume
    column    = cnp
</list_header>
#+end_src

For the [[(lookup)][lookup]] attribute we have to surround the value aka the field
name, with [ and ].  If there are two or more lookup attributes then
skip the [ and ], like for the [[(column)][column]] attributes.

**** bindings

Define bindings for Entry widgets mapped to fields. Multiple fields
are allowed.  Force array of single field attributes by surrounding
the value of the config entry with [].

#+begin_src conf
     <bindings>
         <loc_ds>
             table           = siruta
             <search>
                 localitate  = loc_ds
             </search>
             <field>
                 mnemonic    = jud_ds
                 codp        = codp_ds
                 siruta      = siruta_ds
             </field>
         </loc_ds>
     </bindings>
#+end_src

**** tablebindings

**** maintable

Main table attributes. Required PK and FK columns attributes: "rw
= r", and "state = disabled" ???

    - column_name

     |-------------+--------------+-----------------------------------------------|
     | Attribute   | Value        | Description                                   |
     |-------------+--------------+-----------------------------------------------|
     | label       | <string>     | The label of the column                       |
     |-------------+--------------+-----------------------------------------------|
     | state       | disabled     | default widget state                          |
     |             | normal       |                                               |
     |-------------+--------------+-----------------------------------------------|
     | ctrltype    | e            | widget type Tk::Entry                         |
     |             | t            | Tk::Text                                      |
     |             | m            | JComboBox                                     |
     |             | d            | Tk::DateEntry                                 |
     |             | c            | Tk::Checkbutton                               |
     |             | r            | Tk::Radiobuttongroup                          |
     |-------------+--------------+-----------------------------------------------|
     | displ_width | <smallint>   |                                               |
     |-------------+--------------+-----------------------------------------------|
     | valid_width | <smallint>   |                                               |
     |-------------+--------------+-----------------------------------------------|
     | numscale    | <smallint>   | scale: digits after the decimal separator [.] |
     |-------------+--------------+-----------------------------------------------|
     | readwrite   | r            |                                               |
     |             | rw           |                                               |
     |             | ro           |                                               |
     |-------------+--------------+-----------------------------------------------|
     | findtype    | full         |                                               |
     |             | contains     |                                               |
     |             | date         |                                               |
     |             | none         |                                               |
     |-------------+--------------+-----------------------------------------------|
     | bgcolor     | <color_name> | Tk background color in default state          |
     |-------------+--------------+-----------------------------------------------|
     | datatype    | alphanumplus |                                               |
     |             | alphanum     |                                               |
     |             | alpha        |                                               |
     |             | integer      |                                               |
     |             | numeric      |                                               |
     |             | anychar      |                                               |
     |             | email        |                                               |
     |             | date         |                                               |
     |-------------+--------------+-----------------------------------------------|


   - column_name

     |-------------+-------------------+-----------------------------------------------|
     | Attribute   | Value             | Description                                   |
     |-------------+-------------------+-----------------------------------------------|
     | id          | <pos>             | Position in the TM table (from 0)             |
     |-------------+-------------------+-----------------------------------------------|
     | label       | <string>          | The label of the column                       |
     |-------------+-------------------+-----------------------------------------------|
     | displ_width | <smallint>        |                                               |
     |-------------+-------------------+-----------------------------------------------|
     | valid_width | <smallint>        |                                               |
     |-------------+-------------------+-----------------------------------------------|
     | readwrite   | rw                | read and write                                |
     |             | ro                | read only                                     |
     |-------------+-------------------+-----------------------------------------------|
     | tag         | ro_center         | column tags, see Tpda3::Tk::TM                |
     |             | find_left         |                                               |
     |             | find_center       |                                               |
     |             | find_right        |                                               |
     |             | ro_left           |                                               |
     |             | ro_center         |                                               |
     |             | ro_right          |                                               |
     |             | enter_left        |                                               |
     |             | enter_center      |                                               |
     |             | enter_right       |                                               |
     |             | enter_center_blue |                                               |
     |-------------+-------------------+-----------------------------------------------|
     | numscale    | <smallint>        | scale: digits after the decimal separator [.] |
     |-------------+-------------------+-----------------------------------------------|
     | datatype    | alphanumplus      |                                               |
     |             | alphanum          |                                               |
     |             | alpha             |                                               |
     |             | integer           |                                               |
     |             | numeric           |                                               |
     |             | anychar           |                                               |
     |             | email             |                                               |
     |             | date              |                                               |
     |-------------+-------------------+-----------------------------------------------|

* Anexa

#+begin_src bash
.tpda3/
├── apps
│   ├── test-tk
│   └── test-wx
├── cm
│   ├── data
│   │   ├── COPYING
│   │   ├── ...
│   │   ├── country.dat
│   └── sql
│       └── classicmodels-si.sql
├── etc
│   ├── default.yml
│   ├── interfaces
│   │   ├── icons
│   │   │   ├── actattach16.gif
│   │   │   ├── ...
│   │   │   └── README
│   │   ├── menubar_ro.yml
│   │   ├── menubar.yml
│   │   ├── toolbar_ro.yml
│   │   └── toolbar.yml
│   ├── localisation
│   │   ├── english.conf
│   │   └── romanian.conf
│   ├── log.conf
│   ├── main.yml
│   └── xresource.xrdb
├── help
│   ├── ghid.html
│   └── guide.htb
├── license
│   └── gpl.txt
├── scr
│   ├── repman.conf
│   └── reports.conf
├── tpda3.ico
└── tpda3.png
#+end_src
